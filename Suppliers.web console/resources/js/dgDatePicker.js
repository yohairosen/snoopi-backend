/* Javascript by Daniel Cohen Gindi (c) danielgindi@gmail.com 054-5655765 */
/* Depends on dgTools.js */
/* Version: 2012-04-26 */
(function(){var e=dgTools,g=e.dom,h=Class.extend({DefaultOptions:{culture:"en",closeButton:"auto",autoHide:!0,autoShow:!0,hideOnSelect:!0,target:null,input:null,firstDay:1,dismiss:null,change:null,dayClicked:null,dateSelected:null,show:null},init:function(a){this.settings=e.extend({},this.DefaultOptions);this.settings.date=new Date;this.setOptions(a||{});this.Controls={};return this},findCulture:function(a,b){var c=this.settings;if(!a)return b?this.findCulture(c.culture):null;if("string"!=typeof a)return a;
if("auto"==a)for(var d=document.getElementsByTagName("meta"),f=0;f<d.length;f++){var e=d[f];if("content"==(e.getAttribute("http-equiv")||"").toLowerCase()){e=(e.getAttribute("content")||"").split(/,/g);for(d=0;d<e.length;d++)if(a=e[d],a=this.findCulture(a,b))return a;break}}if(h.Cultures[a])return h.Cultures[a];f=a.lastIndexOf("-");return-1<f?(a=a.substr(0,f),this.findCulture(a,b)):b?this.findCulture(c.culture):null},prepareCulture:function(){for(var a=this.settings.culture,b=document.getElementsByTagName("script"),
c=0;c<b.length;c++){var d=b[c];if(d.src&&(d.src.match(/dgDatePicker\.js(\?.*)?$/)||d.src.match(/dgDatePicker_src\.js(\?.*)?$/))){a=(b=d.src.match(/\?.*culture=([a-z\-]*)/i))?b[1]:a;break}}"string"==typeof a&&(a=this.findCulture(a,!0));this.Culture=a;this._preparedCulture=!0},buildView:function(){var a=this,b=a.settings,c,d=a.Controls;if(a.view)return a;c=a.view=g.build("div",{"class":b.className+(a.Culture.rtl?" "+b.className+"-rtl":""),tabIndex:-1},[d.title=g.build("div",{"class":b.className+"-title"},
[d["month-prev"]=g.build("div",{"class":b.className+"-month-prev"},[d["month-prev-inner"]=g.build("span")]),d["month-name"]=g.build("div",{"class":b.className+"-month-name",text:a.Culture.monthArrayLong[b.date.getMonth()]+" "+b.date.getFullYear()}),d["month-next"]=g.build("div",{"class":b.className+"-month-next"},[d["month-next-inner"]=g.build("span")])]),d["day-titles"]=g.build("div",{"class":b.className+"-day-titles"}),d.month=g.build("div",{"class":b.className+"-month"}),d.actions=g.build("div",
{"class":b.className+"-actions"},[d.today=g.build("span",{"class":b.className+"-action "+b.className+"-action-today",text:a.Culture.today}),d.close=g.build("span",{"class":b.className+"-action "+b.className+"-action-close",text:a.Culture.close})])]);a.observeLongClick(d["month-prev"],function(){a.prevMonth()});a.observeLongClick(d["month-next"],function(){a.nextMonth()});e.observe(d.today,"click",function(){a.today()});e.observe(d.close,"click",function(){a.hide()});for(var f=0,j=b.firstDay-1;7>f;f++,
j++)d["day-titles"].appendChild(d["day-title-"+j]=g.build("span",{"class":b.className+"-day-title",text:a.Culture.dayArrayShort[j]})),6==j&&(j=-1);a.buildDays();e.observe(c,"touchstart",e.observe(c,"mousedown",function(a){var b=new e.Event(a);b.stop();g.enableImageDragging(b.target,!1);g.enableTextSelect(!1);var c=e.observe(document,"touchcancel",e.observe(document,"touchend",e.observe(document,"mouseup",function(){e.unobserve(document,"touchcancel",c,!1);e.unobserve(document,"touchend",c,!1);e.unobserve(document,
"mouseup",c,!0);g.enableImageDragging(b.target,!0);g.enableTextSelect(!0)},!0),!1),!1)},!1),!1);c=null;return a},buildDays:function(){var a=this,b=a.settings,c=a.Controls.month,d,f,e=function(){var e=b.date;f=new Date(e);f.setDate(1);f.setDate(f.getDate()-(f.getDay()-(b.firstDay-1)));for(var j=0;c.firstChild;)c.removeChild(c.firstChild);for(;1!=f.getDate();)d=g.build("span",{"class":b.className+"-day "+b.className+"-day-blank",text:f.getDate().toString()}),d.date=new Date(f),c.appendChild(d),a.registerDayEvents(d,
!0),f.setDate(f.getDate()+1),j++;for(var h=f.getMonth();f.getMonth()==h;){var k=a.markedDays&&$isArray(a.markedDays);if(k)for(var k=!1,l=0;l<a.markedDays.length&&!(k=a.markedDays[l],k=k.getDate()==f.getDate()&&k.getMonth()==f.getMonth()&&k.getYear()==f.getYear());l++);d=g.build("span",{"class":b.className+"-day"+(f.getDate()==e.getDate()?" "+b.className+"-day-current":"")+(k?" "+b.className+"-day-marked":""),text:f.getDate().toString()});d.date=new Date(f);c.appendChild(d);a.registerDayEvents(d,!1);
f.setDate(f.getDate()+1);j++}for(;42>j;)d=g.build("span",{"class":b.className+"-day "+b.className+"-day-blank",text:f.getDate().toString()}),d.date=new Date(f),c.appendChild(d),a.registerDayEvents(d,!0),f.setDate(f.getDate()+1),j++;d=c=null;a.setViewCss()};b.dataSource&&b.dataSource.markedDaysForMonth?b.dataSource.markedDaysForMonth(new Date(b.date),function(b){a.markedDays=b;e()}.bind(a)):e();return a},injectCss:function(){if(h._cssInjected)return this;h._cssInjected=!0;var a=document.getElementsByTagName("head")[0],
b=".dgDatePicker{position:absolute;z-index:600;background:#fff;border:1px solid #a0a0a0;padding:2px;font:12px Tahoma, Arial;cursor:default;width:145px;height:153px;-webkit-box-shadow:2px 2px 3px 0px #aaa;-moz-box-shadow:2px 2px 3px 0px #aaa;box-shadow:2px 2px 3px 0px #aaa}.dgDatePicker-title{height:16px;position:relative;background:#f0f0f0}.dgDatePicker-month-name{text-align:center}.dgDatePicker-month-prev,.dgDatePicker-month-next{position:absolute;top:0;width:4px;height:7px;padding:4px 5px 5px 5px}.dgDatePicker-month-prev{left:0;}.dgDatePicker-month-next{right:0;}.dgDatePicker-rtl .dgDatePicker-month-prev{left:auto;right:0;}.dgDatePicker-rtl .dgDatePicker-month-next{right:auto;left:0;}.dgDatePicker-month-prev span,.dgDatePicker-month-next span{display:inline-block;vertical-align:top;width:0;height:0;border-top:4px solid transparent;border-bottom:4px solid transparent;}.dgDatePicker-month-prev span,.dgDatePicker-rtl .dgDatePicker-month-next span{border-right:4px solid #000;border-left:none;}.dgDatePicker-month-next span,.dgDatePicker-rtl .dgDatePicker-month-prev span{border-left:4px solid #000;border-right:none;}.dgDatePicker-day-titles{width:119px;height:16px;border-bottom:1px solid #f0f0f0;margin:0 auto 1px auto;padding:0 7px;}.dgDatePicker-month{width:119px;height:91px;border-bottom:1px solid #f0f0f0;margin:0 auto;padding:0 7px}.dgDatePicker-actions{text-align:center;margin:5px auto 0 auto;}.dgDatePicker-action{display:inline-block;vertical-align:top;height:15px;padding:2px 3px;margin:0 1px;font:12px/15px Arial;color:#000;cursor:pointer;background:#f0f0f0;}.dgDatePicker-action:hover{background:#a0a0a0;}.dgDatePicker-action:active{background:#000;color:#fff}.dgDatePicker-day,.dgDatePicker-day-title{display:inline-block;vertical-align:top;width:17px;height:15px;overflow:hidden;font:12px/15px Arial;color:#000;text-align:center;}.dgDatePicker-day-blank{color:#6d6d6d;}.dgDatePicker-day-current{border:1px solid #bb5503;margin:-1px;}.dgDatePicker-day-active{background:#a0a0a0;}";
if(window.ie&&7<=window.ie||e.Browser.isChrome)b+=".dgDatePicker-month-prev span,.dgDatePicker-month-next span,.dgDatePicker-rtl .dgDatePicker-month-prev span,.dgDatePicker-rtl .dgDatePicker-month-next span{width:4px;height:7px;border:none}.dgDatePicker-month-prev span,.dgDatePicker-rtl .dgDatePicker-month-next span{background:url(data:image/gif;base64,R0lGODlhBAAHAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAAEAAcAAAIIlHEIy7ppBCgAOw%3D%3D)}",b+=".dgDatePicker-month-next span,.dgDatePicker-rtl .dgDatePicker-month-prev span{background:url(data:image/gif;base64,R0lGODlhBAAHAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAAEAAcAAAIIhA4maeyrlCgAOw%3D%3D)}";
var c=g.build("style",{type:"text/css"});c.styleSheet?c.styleSheet.cssText=b:c.appendChild(document.createTextNode(b));a.childNodes?a.insertBefore(c,a.firstChild):a.appendChild(c);return this},setViewCss:function(){return this},updateViewWithDate:function(a,b){var c=this.settings,d=this.Controls;a||(a=new Date);b&&c.change&&c.change(new Date(a));if(!this.view)return c.date=a,this;g.setText(d["month-name"],this.Culture.monthArrayLong[a.getMonth()]+" "+a.getFullYear());if(a.getYear()!=c.date.getYear()||
a.getMonth()!=c.date.getMonth())return c.date=a,this.buildDays();for(var d=d.month,f,e=0,h=d.childNodes.length;e<h;e++)f=d.childNodes[e],f.date&&(f.date.getDate()==a.getDate()&&f.date.getMonth()==a.getMonth()?g.addClassName(f,c.className+"-day-current"):g.hasClassName(f,c.className+"-day-current")&&g.removeClassName(f,c.className+"-day-current"));c.date=a;return this},registerDayEvents:function(a){var b=this,c=b.settings;e.observe(a,"touchstart",e.observe(a,"mousedown",function(){g.addClassName(a,
c.className+"-day-active");var d=e.observe(document,"touchcancel",e.observe(document,"touchend",e.observe(document,"mouseup",function(f){e.unobserve(document,"touchcancel",d,!1);e.unobserve(document,"touchend",d,!1);e.unobserve(document,"mouseup",d,!0);g.removeClassName(a,c.className+"-day-active");f=new e.Event(f);if(f.target==a||g.hasChild(a,f.target))f=c.date,b.setDate(a.date,!0),c.dayClicked?c.dayClicked.bind(b)(new Date(a.date),new Date(f)):f.getMonth()==c.date.getMonth()&&f.getYear()==c.date.getYear()&&
(c.hideOnSelect?b.dismissSelectedDate():b.updateInputValue(!0))},!0),!1),!1)},!1),!1);return b},observeLongClick:function(a,b){if(!b)return this;e.observe(a,"touchstart",e.observe(a,"mousedown",function(){function a(){b();50<d&&(d-=15);0<d&&(f=setTimeout(a,d))}b();var d=300,f=setTimeout(a,d),g=e.observe(document,"touchcancel",e.observe(document,"touchend",e.observe(document,"mouseup",function(){e.unobserve(document,"touchcancel",g,!1);e.unobserve(document,"touchend",g,!1);e.unobserve(document,"mouseup",
g,!0);d=0;f&&clearTimeout(f);f=null},!0),!1),!1)},!1),!1);return this},prevMonth:function(){var a=this.settings,b=new Date(a.date);b.setMonth(a.date.getMonth()-1);this.updateViewWithDate(b,!0);return this},nextMonth:function(){var a=this.settings,b=new Date(a.date);b.setMonth(a.date.getMonth()+1);this.updateViewWithDate(b,!0);return this},today:function(){this.updateViewWithDate(null,!0);return this},setDate:function(a,b){var c=this.settings;this.updateViewWithDate(a,!0);b&&c.dateSelected&&c.dateSelected.bind(this)(new Date(a));
return this},hide:function(a){var b=this.settings;if(!this.visible)return this;this.view&&(b.dismiss&&b.dismiss.apply(this,a?[a]:[]),g.hide(this.view),this._FBlur&&b.input&&(e.unobserve(b.input,"blur",this._FBlur),e.unobserve(this.view,"blur",this._FBlur),this._FBlur=null),this._FGlobalDown&&(e.unobserve(document,"touchstart",this._FGlobalDown,!1),e.unobserve(document,"mousedown",this._FGlobalDown,!1),this._FGlobalDown=null));this.visible=!1;return this},show:function(){var a=this,b=a.settings;if(a.visible)return a;
b.target&&(b.target=e.$(b.target));b.input&&(b.input=e.$(b.input));var c=b.date;b.input&&(c=a.parseDate(b.input.value||""));isNaN(c.getYear())&&(c=new Date);a.updateViewWithDate(c);a.view||(a.buildView(),g.hide(a.view),(b.parent?b.parent:document.body).appendChild(a.view),a.setViewCss());"auto"==b.closeButton&&b.input||"yes"==b.closeButton?g.show(a.Controls.close):g.hide(a.Controls.close);a.injectCss();a.updatePosition();b.input&&b.autoHide&&(a._FBlur=e.observe(b.input,"blur",function(c){for(c=c.explicitOriginalTarget||
document.activeElement;c;){if(c==a.view||c==b.input)return;c=c.parentNode}a.hide()}),e.observe(a.view,"blur",a._FBlur));b.autoHide&&(a._FGlobalDown=e.observe(document,"touchstart",e.observe(document,"mousedown",function(c){c=new e.Event(c);c.target==a.view||(b.input&&c.target==b.input||g.hasChild(a.view,c.target)||b.input&&g.hasChild(b.input,c.target))||a.hide()},!1),!1));b.show&&b.show();a.visible=!0;return a},updatePosition:function(){var a=this.settings;if(a.parent)g.css(this.view,{position:"relative"});
else{var b=function(a,b){a=(a||"").split(/ |,/);var c=a[0],d=a[1],c="right"==c?b.width:"center"==c?b.width/2:"left"==c?0:c&&"string"==typeof c&&"%"==c.charAt(c.length-1)?b.width*((parseFloat(c)||0)/100):parseFloat(c)||0,d="bottom"==d?b.height:"center"==d?b.height/2:"top"==d?0:d&&"string"==typeof d&&"%"==d.charAt(d.length-1)?b.height*((parseFloat(d)||0)/100):parseFloat(d)||0;return{left:c,top:d}},c=a.target;c||(c=document.body,"static"==g.css(c,"position")&&(c=c.parentNode));var d=a.target?g.totalSize(a.target):
g.size(c);anchor=b(a.anchor,g.totalSize(this.view));position=b(a.position,d);b={left:0,top:0};if(a.target){var e=function(a){return document.body==a?0:(a.scrollTop||0)+(a.parentNode?e(a.parentNode):0)},h=function(a){return document.body==a?0:(a.scrollLeft||0)+(a.parentNode?h(a.parentNode):0)},b=g.offset(c),b={left:b[0],top:b[1]};window.getScrollOffsets();b.left+=h(c);b.top+=e(c)}b.left+=position.left-anchor.left;b.top+=position.top-anchor.top;g.css(this.view,{left:b.left+"px",top:b.top+"px"})}g.show(this.view);
return this},getDate:function(){return this.settings.date},getDateString:function(a){var b=this.settings,c=a.getDate().toPaddedString(2),d=(a.getMonth()+1).toPaddedString(2);return b.dateFormat.replace("yyyy",a.getFullYear()).replace("MM",d).replace("dd",c)},parseDate:function(a){if(a instanceof Date)return a;var b=this.settings.dateFormat,c,d=new Date,e={yyyy:d.getFullYear(),MM:d.getMonth()+1,dd:d.getDate()};[{part:"yy",key:"yyyy"},{part:"yyyy",key:"yyyy"},{part:"MM",key:"MM"},{part:"dd",key:"dd"}].forEach(function(d){c=
b.indexOf(d.part);-1<c&&(e[d.key]=parseInt(a.substr(c,d.part.length),10))});return new Date(e.yyyy,e.MM-1,e.dd)},updateInputValue:function(a){var b=this.settings;if(b.input){b.input=e.$(b.input);var c=this.getDateString(this.getDate());b.input.value=c;a&&b.input.focus()}return this},dismissSelectedDate:function(){this.updateInputValue(!0);this.hide(new Date(this.getDate()));return this},setOptions:function(a){var b=this,c=b.settings,d=c.culture,c=b.settings=e.extend(c,a);(d!=c.culture||!b._preparedCulture)&&
b.prepareCulture();a.dateFormat||(c.dateFormat=b.Culture.defaultDateFormat);a.input||(c.input=null);a.target||(c.target=null);c.className=c.className||"dgDatePicker";1>c.firstDay?c.firstDay=1:7<c.firstDay&&(c.firstDay=7);c.position||(c.position=b.Culture.rtl?"left top":"right top");c.anchor||(c.anchor=b.Culture.rtl?"right top":"left top");null==c.target&&(c.target=c.input);b._FFocus&&b._FFocusEl&&(e.unobserve(b._FFocusEl,"focus",b._FFocus),b._FFocusEl=b._FFocus=null);if(c.autoShow&&a.input){if(a=
e.$(a.input))b._FFocus=e.observe(a,"focus",function(){c.autoShow&&!b.visible&&b.show()}),b._FFocusEl=a;a=null}return b},destroy:function(){this.hide();this._FFocus&&this._FFocusEl&&(e.unobserve(this._FFocusEl,"focus",this._FFocus),this._FFocusEl=this._FFocus=null);for(var a in this.Controls)this.Controls.hasOwnProperty(a)&&delete this.Controls[a];this.Controls={};delete this.view;for(a in this)this.hasOwnProperty(a)&&$isFunction(this[a])&&(this[a]=function(){});return null}});h.Cultures={en:{defaultDateFormat:"MM/dd/yyyy",
dayArrayShort:"SMTWTFS".split(""),dayArrayLong:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),monthArrayShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthArrayLong:"January February March April May June July August September October November December".split(" "),close:"close",today:"today"},he:{defaultDateFormat:"dd/MM/yyyy",dayArrayShort:"\u05d0\u05d1\u05d2\u05d3\u05d4\u05d5\u05e9".split(""),dayArrayLong:"\u05e8\u05d0\u05e9\u05d5\u05df \u05e9\u05e0\u05d9 \u05e9\u05dc\u05d9\u05e9\u05d9 \u05e8\u05d1\u05d9\u05e2\u05d9 \u05d7\u05de\u05d9\u05e9\u05d9 \u05e9\u05d9\u05e9\u05d9 \u05e9\u05d1\u05ea".split(" "),
monthArrayShort:"\u05d9\u05e0\u05d5 \u05e4\u05d1\u05e8 \u05de\u05e8\u05e5 \u05d0\u05e4\u05e8 \u05de\u05d0\u05d9 \u05d9\u05d5\u05e0 \u05d9\u05d5\u05dc \u05d0\u05d5\u05d2 \u05e1\u05e4\u05d8 \u05d0\u05d5\u05d2 \u05e0\u05d5\u05d1 \u05d3\u05e6\u05de".split(" "),monthArrayLong:"\u05d9\u05e0\u05d5\u05d0\u05e8 \u05e4\u05d1\u05e8\u05d5\u05d0\u05e8 \u05de\u05e8\u05e5 \u05d0\u05e4\u05e8\u05d9\u05dc \u05de\u05d0\u05d9 \u05d9\u05d5\u05e0\u05d9 \u05d9\u05d5\u05dc\u05d9 \u05d0\u05d5\u05d2\u05d5\u05e1\u05d8 \u05e1\u05e4\u05d8\u05de\u05d1\u05e8 \u05d0\u05d5\u05e7\u05d8\u05d5\u05d1\u05e8 \u05e0\u05d5\u05d1\u05de\u05d1\u05e8 \u05d3\u05e6\u05de\u05d1\u05e8".split(" "),
close:"\u05e1\u05d2\u05d5\u05e8",today:"\u05d4\u05d9\u05d5\u05dd",rtl:!0}};h.show=function(a){var b=h._global_instance;b||(b=h._global_instance=new h(a));b.hide();b.setOptions(a);b.show();return b};h.hide=function(){h._global_instance&&h._global_instance.hide();return h._global_instance||null};window.dgDatePicker=h})();
